<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Container Manager: Container Manager Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Container Manager
   </div>
   <div id="projectbrief">Container Manager is a production ready C++ service for managing containers in Podman, Docker.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_komal_workspace_personal_container_manager_docs_architecture_architecture.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Container Manager Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md31"></a>
Overview</h1>
<p><b>Container Manager</b> is a modular, extensible, and production-ready C++ service designed to provide unified container management across multiple runtimes, including Docker and Podman, with support for additional engines planned. The system is architected for flexibility, security, and ease of integration in automotive environment deployments.</p>
<p>Container Manager abstracts the complexity of managing containers by exposing a unified API over multiple communication protocols—REST, MQTT, POSIX Message Queue, D-Bus, and (planned) gRPC. It supports both JSON and Protocol Buffers (Protobuf) as data formats, allowing seamless integration with a wide range of clients and systems.</p>
<p><b>Key architectural highlights:</b></p>
<ul>
<li><b>Protocol-Agnostic Core:</b> <br  />
 The business logic and command execution are completely decoupled from protocol handling, enabling easy addition of new communication methods without impacting core functionality.</li>
<li><b>Extensible <a class="el" href="classCommand.html" title="Abstract base class for all commands.">Command</a> Pattern:</b> <br  />
 All container operations (create, start, stop, etc.) are encapsulated as command objects, making it straightforward to add new operations or support new container runtimes.</li>
<li><b>Pluggable Data Formats:</b> <br  />
 Both JSON and Protobuf are supported for all protocols, with the ability to add more serialization formats as needed.</li>
<li><b>Pluggable Database Backend:</b> <br  />
 The system supports both an embedded in-memory database (default) and Redis for scalable, production deployments. The database interface is abstracted, allowing further extension.</li>
<li><b>Enterprise-Grade Security:</b> <br  />
 All incoming protocol payloads can be encrypted using AES-256-GCM or ChaCha20-Poly1305. The security layer is protocol-agnostic and auto-detects encrypted payloads, ensuring confidentiality and integrity for over-the-air (OTA) requests. Key management is handled via secure, hex-encoded files.</li>
<li><b>Thread Pool and Robust Logging:</b> <br  />
 All protocol handlers leverage a shared thread pool for efficient, concurrent request processing. Logging is handled via Google glog for production-grade diagnostics.</li>
<li><b>Production-Ready and Configurable:</b> <br  />
 All features (protocols, data formats, security, database backend) are enabled or disabled at build time via CMake flags, making the system highly configurable for different deployment scenarios.</li>
</ul>
<p><b>Intended Audience:</b> <br  />
 This architecture is aimed at developers, system integrators, and architects who require a secure, extensible, and maintainable foundation for building unified container orchestration solutions—especially in environments where protocol diversity, security, and modularity are critical.</p>
<p><b>Design Philosophy:</b></p>
<ul>
<li><b>Separation of Concerns:</b> Each layer (API, executor, core, runtime, database, security) is isolated and replaceable.</li>
<li><b>Extensibility:</b> New protocols, runtimes, data formats, and security algorithms can be added with minimal changes to existing code.</li>
<li><b>Security by Design:</b> Encryption is integrated at the protocol boundary, with a focus on OTA request confidentiality and integrity.</li>
<li><b>Production Focus:</b> Features like graceful shutdown, centralized configuration, and robust logging are built-in.</li>
</ul>
<p>This document provides a deep dive into the system architecture, component responsibilities, data flow, extensibility points, and the design patterns that make Container Manager a robust foundation for modern container management needs.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
System Architecture</h1>
<p><img src="system_architecture.png" alt="System Architecture" width="1000" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md33"></a>
Folder Structure</h1>
<div class="fragment"><div class="line">App/</div>
<div class="line">├── api/          # Protocol handlers (REST, MQTT, MQ, D-Bus and future protocols)</div>
<div class="line">├── core/         # Business logic (service layer)</div>
<div class="line">├── database/     # Database interface, embedded and Redis implementations (pluggable)</div>
<div class="line">├── executor/     # Request executors (JSON, Protobuf, handle decryption)</div>
<div class="line">├── runtime/      # Command pattern implementations for Docker CLI, Podman CLI, Docker API, Podman API, etc.</div>
<div class="line">├── utils/        # Common utilities (thread pool, logging, etc.)</div>
<div class="line">├── security/     # Security providers (AES-GCM, ChaCha20, Null)</div>
<div class="line">├── main.cpp      # Application entry point</div>
<div class="line">└── third_party/  # External dependencies (nlohmann_json, httplib)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md34"></a>
Design Patterns Used</h1>
<p>This project leverages several classic software design patterns to ensure modularity, extensibility, and maintainability:</p>
<ul>
<li><b><a class="el" href="classCommand.html" title="Abstract base class for all commands.">Command</a> Pattern:</b> <br  />
 Encapsulates each container operation (create, start, stop, etc.) as a command object. <br  />
 <em>Location:</em> <code>runtime/</code>, <code>core/</code></li>
<li><b>Factory Pattern:</b> <br  />
 Used to instantiate the correct command or handler based on runtime/operation. <br  />
 <em>Location:</em> <code>runtime/</code> (<a class="el" href="classCommandFactory.html" title="Factory class to create command objects based on the request structure.">CommandFactory</a>), <code>api/</code> Allows pluggable encryption algorithms (AES-GCM, ChaCha20, etc.) via interchangeable security providers during build compilation. <em>Location:</em> <code>security/</code></li>
<li><b>Service Pattern:</b> <br  />
 Encapsulates business logic and coordinates operations between components. <br  />
 <em>Location:</em> <code>core/</code> (e.g., <code><a class="el" href="classContainerServiceHandler.html" title="Handles container operations and updates status in the database.">ContainerServiceHandler</a></code>)</li>
<li><b>Abstract Factory / Interface Pattern:</b> <br  />
 Provides contracts for interchangeable components such as database backends and security providers. <br  />
 <em>Location:</em> <code>database/</code> (<code><a class="el" href="classIDatabaseHandler.html" title="Interface for database handlers supporting JSON storage and retrieval.">IDatabaseHandler</a></code>), <code>security/</code> (<code><a class="el" href="classISecurityProvider.html" title="Abstract interface for security providers (encryption/decryption).">ISecurityProvider</a></code>)</li>
<li><b>Observer/Subscriber Pattern:</b> <br  />
 Protocol handlers (MQTT, Message Queue, D-Bus) listen for and react to incoming messages/events. <br  />
 <em>Location:</em> <code>api/</code></li>
</ul>
<p>These patterns make the codebase easy to extend (e.g., adding new runtimes, protocols, or security algorithms) and maintain over time.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Component Descriptions</h1>
<p>The following components are organized to match the folder structure of the project:</p>
<h2><a class="anchor" id="autotoc_md36"></a>
1. API Layer ( api/ )</h2>
<ul>
<li><b>REST API Server:</b> <br  />
 Handles HTTP requests, parses JSON/Protobuf payloads (optionally encrypted), and forwards them to the executor layer.</li>
<li><b>MQTT Subscriber:</b> <br  />
 Subscribes to a configured MQTT topic, receives messages (optionally encrypted), and forwards them to the executor.</li>
<li><b>POSIX Message Queue Consumer:</b> <br  />
 Listens on a POSIX message queue for incoming requests (optionally encrypted).</li>
<li><b>D-Bus Consumer:</b> <br  />
 Listens for method calls on the D-Bus session bus, enabling desktop and user-level IPC. Supports encrypted and unencrypted payloads, with automatic Base64 decoding for binary data.</li>
<li><b>gRPC Server (planned):</b> <br  />
 Will provide a strongly-typed, high-performance RPC interface using Protobuf.</li>
</ul>
<blockquote class="doxtable">
<p>All protocol handlers are modular and can be enabled/disabled at build time via CMake flags. <br  />
 All protocols support secure payload delivery using AES-256-GCM or ChaCha20-Poly1305 encryption for incoming data when enabled. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md37"></a>
2. Core Layer ( core/ )</h2>
<ul>
<li><b>Container Service Handler:</b> <br  />
 Central business logic. Receives validated requests from executors, performs runtime checks, and dispatches commands.</li>
<li><b>Service Pattern:</b> <br  />
 Encapsulates business logic and coordinates operations between components. Each container operation (create, start, stop, etc.) is encapsulated as a command object. Supports multiple runtimes (Docker CLI, Podman CLI, Docker API, Podman API, etc.) and is easily extensible.</li>
</ul>
<h2><a class="anchor" id="autotoc_md38"></a>
3. Database Layer ( database/ )</h2>
<ul>
<li><b><a class="el" href="classIDatabaseHandler.html" title="Interface for database handlers supporting JSON storage and retrieval.">IDatabaseHandler</a>:</b> <br  />
 Abstract interface for database operations (CRUD, state, metadata).</li>
<li><b><a class="el" href="classEmbeddedDatabaseHandler.html" title="Lightweight, fixed-size in-memory key-value store for embedded systems.">EmbeddedDatabaseHandler</a>:</b> <br  />
 <b>Default:</b> Lightweight, fixed-size, in-memory key-value store for embedded and resource-constrained systems. <br  />
 No external dependencies required.</li>
<li><b><a class="el" href="classRedisDatabaseHandler.html" title="Class for interacting with a Redis database backend.">RedisDatabaseHandler</a>:</b> <br  />
 Optional production-ready Redis implementation of the database interface. <br  />
 Requires <a href="https://github.com/Cylix/cpp_redis">cpp_redis</a> and a running Redis server.</li>
</ul>
<blockquote class="doxtable">
<p>The database layer is pluggable—swap between embedded and Redis (or any other backend) by implementing the interface. <br  />
 Database selection is controlled via the <code>ENABLE_REDIS</code> CMake flag. If not set, the embedded database is used by default. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md39"></a>
4. Executor Layer ( executor/ )</h2>
<ul>
<li><b>JSON Request Executor:</b> <br  />
 Validates and parses incoming JSON requests (optionally decrypting them), converting them to internal command objects.</li>
<li><b>Protobuf Request Executor:</b> <br  />
 Validates and parses incoming Protobuf requests (optionally decrypting them), converting them to internal command objects.</li>
</ul>
<blockquote class="doxtable">
<p>The executor layer abstracts data format and encryption handling, allowing protocol handlers to remain agnostic of the underlying serialization and security. <br  />
 The executor auto-detects if the payload is encrypted:</p>
<ul>
<li>For JSON: If parsing as JSON fails, it attempts decryption and parses again.</li>
<li>For Protobuf: If parsing as Protobuf fails, it attempts decryption and parses again.</li>
<li>This ensures that all protocols (REST, MQTT, MQ, D-Bus) can send either encrypted or unencrypted payloads without any protocol-specific logic. </li>
</ul>
</blockquote>
<h2><a class="anchor" id="autotoc_md40"></a>
5. Runtime Layer ( runtime/ )</h2>
<ul>
<li><b>Docker Commands:</b> <br  />
 Implements container operations for Docker using the Docker CLI.</li>
<li><b>Podman Commands:</b> <br  />
 Implements container operations for Podman using the Podman CLI.</li>
<li><b>Docker API Commands:</b> <br  />
 Implements container operations using the Docker REST API over a Unix socket.</li>
<li><b>Podman API Commands:</b> <br  />
 Implements container operations using the Podman REST API over a Unix socket.</li>
</ul>
<blockquote class="doxtable">
<p><b>Disclaimer:</b> <br  />
 The <code>podman-api</code> runtime is not extensively tested. Use with caution and report any issues you encounter. </p>
</blockquote>
<blockquote class="doxtable">
<p>The runtime layer can be extended to support additional container engines and APIs. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md41"></a>
6. Utilities ( utils/ )</h2>
<ul>
<li><b>Thread Pool:</b> <br  />
 Efficiently handles concurrent requests.</li>
<li><b>Logging:</b> <br  />
 Uses Google glog for robust, production-grade logging.</li>
<li><b>Config:</b> <br  />
 Centralized configuration structs for all protocols and system settings.</li>
<li><b>curl:</b> <br  />
 Utility for HTTP(S) and Unix socket requests, used for interacting with Docker/Podman APIs and other endpoints.</li>
<li><b>init:</b> <br  />
 Initialization helpers for setting up application state, configuration, and environment before starting protocol handlers.</li>
</ul>
<h2><a class="anchor" id="autotoc_md42"></a>
7. Security &amp; Encryption ( security/ )</h2>
<ul>
<li><b>Security Providers:</b> <br  />
 Pluggable encryption/decryption providers implementing AES-256-GCM and ChaCha20-Poly1305 algorithms.</li>
<li><b>Key Management:</b> <br  />
 Keys are stored as hex-encoded files in <code>storage/security/</code> (<code>aes_key.txt</code>, <code>chacha20_key.txt</code>) and loaded at runtime.</li>
<li><b>Decryption Workflow:</b> <br  />
 When <code>ENABLE_ENCRYPTION</code> is ON, all incoming protocol payloads can be decrypted using the selected algorithm. <br  />
 The executor layer auto-detects and decrypts encrypted payloads before parsing, regardless of protocol or data format.</li>
<li><b>Protocol Agnostic:</b> <br  />
 All protocol handlers (REST, MQTT, MQ, D-Bus) support secure payload delivery and decryption.</li>
<li><b>Configuration:</b> <br  />
 Encryption can be enabled/disabled at build time (<code>ENABLE_ENCRYPTION</code> CMake flag). <br  />
 The algorithm is selected via <code>SECURITY_ALGORITHM</code>.</li>
<li><b>Limitation:</b> <br  />
 Only incoming data is decrypted; outgoing responses are not encrypted.</li>
</ul>
<h1><a class="anchor" id="autotoc_md43"></a>
Data Flow</h1>
<ol type="1">
<li><b>Request Reception:</b> <br  />
 A request arrives via one of the enabled protocols (REST, MQTT, MQ, D-Bus, gRPC (planned)). <br  />
 If encryption is enabled, the payload may be encrypted.</li>
<li><b>Deserialization &amp; Decryption:</b> <br  />
 The protocol handler forwards the raw payload to the appropriate executor (JSON or Protobuf). <br  />
 <b>The executor detects if the payload is encrypted and, if so, decrypts it using the configured algorithm before parsing.</b><ul>
<li>For JSON: If parsing fails, decryption is attempted.</li>
<li>For Protobuf: If parsing fails, decryption is attempted.</li>
</ul>
</li>
<li><b>Validation &amp; Parsing:</b> <br  />
 The executor validates the request and converts it to an internal command object.</li>
<li><b>Business Logic:</b> <br  />
 The service handler checks runtime constraints, permissions, and dispatches the command.</li>
<li><b><a class="el" href="classCommand.html" title="Abstract base class for all commands.">Command</a> Execution:</b> <br  />
 The command object performs the requested operation (e.g., create/start/stop container) using the appropriate runtime (Docker CLI, Podman CLI, Docker API, Podman API).</li>
<li><b>Database Interaction:</b> <br  />
 State and metadata are persisted/retrieved via the database interface. <br  />
 The actual backend (embedded or Redis) is selected at build time.</li>
<li><b>Response:</b> <br  />
 The result is sent back via the originating protocol (if applicable). <br  />
 <b>Note:</b> Outgoing responses are not encrypted by this application.</li>
</ol>
<h1><a class="anchor" id="autotoc_md44"></a>
Extensibility</h1>
<ul>
<li><b>Add a Protocol:</b> <br  />
 Implement a new handler in <code>api/</code>, register it in <code><a class="el" href="main_8cpp.html" title="Entry point for the Container Manager service.">main.cpp</a></code>, and add a CMake flag.</li>
<li><b>Add a Data Format:</b> <br  />
 Implement a new executor in <code>executor/</code>, update protocol handlers to support it.</li>
<li><b>Add a Runtime:</b> <br  />
 Implement new command classes in <code>runtime/</code>, register them in the command factory.</li>
<li><b>Change Database:</b> <br  />
 Implement <code><a class="el" href="classIDatabaseHandler.html" title="Interface for database handlers supporting JSON storage and retrieval.">IDatabaseHandler</a></code> for your preferred backend. <br  />
 Select the backend at build time using the appropriate CMake flag.</li>
<li><b>Change Security:</b> <br  />
 Update the encryption key, IV/nonce, or algorithm as needed. <br  />
 Toggle decryption support at build time with <code>ENABLE_ENCRYPTION</code>. <br  />
 Add new security algorithms by implementing a new provider in <code>security/</code> and updating the executor logic.</li>
</ul>
<h1><a class="anchor" id="autotoc_md45"></a>
Production-Readiness</h1>
<ul>
<li><b>Graceful Shutdown:</b> <br  />
 All protocol consumers support <code><a class="el" href="namespaceCommandTemplate.html#a360167789598bf328488e90755b12035">Stop()</a></code> and <code>Join()</code> for clean shutdown.</li>
<li><b>Signal Handling:</b> <br  />
 (Recommended) Add signal handlers for SIGINT/SIGTERM to trigger shutdown.</li>
<li><b>Configurable:</b> <br  />
 All protocol and system settings are centralized and can be externalized.</li>
<li><b>Logging:</b> <br  />
 All errors and key events are logged with context.</li>
<li><b>Testing:</b> <br  />
 Unit and integration tests are present; expand coverage as needed.</li>
<li><b>Security:</b> <br  />
 AES-256-GCM and ChaCha20-Poly1305 decryption is available for all protocols and data formats, providing strong security guarantees for production deployments. <br  />
 <b>Encryption of outgoing responses is not implemented.</b></li>
</ul>
<h1><a class="anchor" id="autotoc_md46"></a>
Example Sequence Diagram</h1>
<p><img src="architecture_example_sequence_diagram.png" alt="Example Sequence Diagram" width="1000" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md47"></a>
Deployment Diagram</h1>
<p><img src="architecture_deployment_diagram.png" alt="Deployment Diagram" width="800" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md48"></a>
Recommendations for Contributors</h1>
<ul>
<li><b>Follow the modular architecture:</b> <br  />
 Add new features as isolated modules with clear interfaces.</li>
<li><b>Document all public APIs and classes.</b></li>
<li><b>Write tests for new features and bug fixes.</b></li>
<li><b>Update diagrams and documentation as the architecture evolves.</b></li>
<li><b>If you add or change encryption/decryption, update this document and the security section.</b></li>
</ul>
<h1><a class="anchor" id="autotoc_md49"></a>
References</h1>
<ul>
<li><a href="../doxygen/html/index.html">Doxygen Documentation</a></li>
<li>../../README.md "README.md"</li>
</ul>
<hr  />
<p><em>For questions, suggestions, or contributions, please open an issue or pull request on GitHub.</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
